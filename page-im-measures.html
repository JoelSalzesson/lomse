<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Lomse library. API documentation: How measures are modelled</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.25.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="modules.html"><span>Types&#160;and&#160;constants</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li class="current"><a href="pages.html"><span>Other</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page-im-measures.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How measures are modelled </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#im-measures-intro">Approach followed in Lomse</a></li>
<li class="level1"><a href="#im-measures-needs">The measures table</a><ul><li class="level2"><a href="#im-measures-table">ImMeasuresTable</a></li>
<li class="level2"><a href="#im-measures-timegridtable">TimeGridTable</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="im-measures-intro"></a>
Approach followed in Lomse</h1>
<p>Initially, the idea of using a <em>measure container</em> to hold the staff objects was considered. But measures only exist when time signatures and barlines exist, and Lomse should be able to represent multi-metric and non-measured music.</p>
<p>The approach followed in Lomse has been to represent the music as a linearized sequence of staff objects (notes, rests, etc.) with explicit barline objects. As a measure extends from one barline to the next one, both representations (with or without measures containers) are equivalent: given the barlines it is easy to deduce measure limits in data which has no such measure containers; and given the measure containers, it is easy to produce a linearized sequence with only barlines. So both approaches are equivalent. But by using a measure container, Lomse will have to force a special case for music that has no measures. Therefore, the decision was not to include measure containers in the internal model. But as not all barlines defines the boundaries for measures (e.g. intermediate barlines) it is necessary to identify these barlines.</p>
<p>Nevertheless, as the concept of measure is very important in most common Western music, there are attributes (e.g. the displayed measure number) that have to be captured when they exist. In Lomse, the barlines contain the measure attributes for the measure that is ending in that barline, such as the displayed measure number. For accessing to this information use method <code>ImoBarline::get_measure_info</code>.</p>
<p>And when the score is incomplete and the last measure is not finished in a barline, the attributes for this last incomplete measure, if exist, are stored in the ImoInstrument object, and are accessible by method <code>ImoInstrument::get_last_measure_info()</code>. Notice that this method will return <span class="literal">nullptr</span> when the score finishes in barline.</p>
<h1><a class="anchor" id="im-measures-needs"></a>
The measures table</h1>
<p>For any method based on measure location information (e.g., for scrolling to measure/beat or for visual tracking effects during payback), it is necessary to solve two needs: </p>
<pre class="fragment">a) The first one is to convert the measure location data into timepos data. This information is inmutable for an internal model the conversion method can be provided by the internal model.

b) And the second one is for converting timepos data into spacial position in the graphic model and vice-versoa (e.g., to determine the timepos for a mouse position). As this information is specific for each graphic model, the conversion method must be provided by the graphic model.
</pre><p>For solving these two needs there exist two objects: ImMeasuresTable and TimeGridTable objects.</p>
<h2><a class="anchor" id="im-measures-table"></a>
ImMeasuresTable</h2>
<p>For solving the need to convert measure location data (e.g. measure/beat) into timepos data, the internal model contains a measures table.</p>
<p>As for multi-metric music the number of measures could be different in each score part (instrument), it is necessary to maintain a table per instrument.</p>
<p>The table is contained and managed by class ImMeasuresTable. Each ImoInstrument object contains an instance, with the specific information for that instrument. For single-metric scores, the tables in all instruments will contain the same data as the number of measures will be the same for all instruments. Each table is accesible by method ImoInstrument::get_measures_table();</p>
<p>ImMeasuresTable objects are created by the model builder (class ModelBuilder) once the ColSatffObjs object is created.</p>
<h2><a class="anchor" id="im-measures-timegridtable"></a>
TimeGridTable</h2>
<p>For solving the need to convert timepos data into spacial position in the graphic model and vice-versa, the TimeGridTable object is responsible for supplying all occupied timepos and their positions.</p>
<p>There exist a TimeGridTable object for each system. It is owned by the GmoBoxSystem object, which provide access to it. Each TimeGridTable object contains a table with the relation timepos &lt;-&gt; x-position for all positions currently occupied by staff objects in the system. The last position is normally the position of the barline at the end of the system. The system provides the y-position and the table the x-postion. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Sat Jul 14 2018 18:15:25 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
